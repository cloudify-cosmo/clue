task:
  retries: 5
  retry_interval: 1
  thread_pool_size: 20

commands:
  install:
    workflow: install

  pip:
    install:
      workflow: execute_operation
      parameters:
        operation: pip.install
        run_by_dependency_order: true
        type_names: [python_package]

  git:
    status:
      task:
        retries: 0
        retry_interval: 0
        thread_pool_size: 1
      workflow: execute_operation
      parameters:
        operation: git.status
        type_names: [git_repo]

    diff:
      args:
        - name: revision_range
          help: range to pass to git diff
      task:
        retries: 0
        retry_interval: 0
        thread_pool_size: 1
      workflow: execute_operation
      parameters:
        operation: git.diff
        type_names: [git_repo]
        allow_kwargs_override: true
        operation_kwargs:
          revision_range: { arg: revision_range }

    pull:
      workflow: execute_operation
      parameters:
        operation: git.pull
        type_names: [git_repo]

    checkout:
      args:
        - name: branch
          help: branch name to checkout
          completer: cdev.completion:branches_completer
      workflow: execute_operation
      parameters:
        allow_kwargs_override: true
        operation: git.checkout
        operation_kwargs:
          branch: { arg: branch }
        type_names: [git_repo]

  nose:
    args:
      - name: package
        help: name of python package to run nosetests on
        completer: cdev.completion:package_completer
    task:
      retries: 0
      retry_interval: 0
    workflow: execute_operation
    parameters:
      operation: nose.run
      node_ids: [{ arg: package }]
